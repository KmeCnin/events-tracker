<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Event Tracker PWA</title>
    
    <link rel="manifest" href="manifest.json">
    <link rel="icon" href="favicon.svg" type="image/svg+xml">
    <meta name="theme-color" content="#4CAF50"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Event Tracker">
    <link rel="apple-touch-icon" href="icon-192x192.png">

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <!-- Added Chart.js for the new chart view -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns/dist/chartjs-adapter-date-fns.bundle.min.js"></script>


    <style>
        body { font-family: 'Inter', sans-serif; }
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap');
        
        .calendar-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 4px; }
        .calendar-day { aspect-ratio: 1 / 1; transition: background-color 0.2s, transform 0.2s; }
        .calendar-day:hover { background-color: #e0f2f1; transform: scale(1.1); z-index: 10; }
        .calendar-day-header { font-size: 0.75rem; color: #6b7280; }
        .marked-day { background-color: #4CAF50; color: white; border-radius: 50%; }
        .tooltip {
            position: absolute;
            transform: translate(-50%, -100%);
            padding: 8px 12px;
            background-color: #333;
            color: white;
            border-radius: 6px;
            font-size: 0.875rem;
            pointer-events: none;
            z-index: 100;
            white-space: nowrap;
        }
    </style>
</head>
<body class="bg-gray-100">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useCallback, useMemo, useRef } = React;

        // --- LocalStorage Database Helpers ---
        const DB_KEY = 'eventTrackerData';

        const generateFakeData = () => {
            const eventName = "Anti-inflammatoires";
            const event = { id: 1, name: eventName };
            const increments = [];

            const now = Date.now();
            let currentTime = now - (365 * 24 * 60 * 60 * 1000); // Start 1 year ago

            const meanInterval = 3 * 24 * 60 * 60 * 1000; // 3 days in ms
            const randomness = 30 * 60 * 60 * 1000; // 30 hours in ms

            for (let i = 0; i < 129; i++) {
                currentTime += meanInterval;
                const randomOffset = (Math.random() * 2 - 1) * randomness;
                const triggerTime = currentTime + randomOffset;
                if (triggerTime > now) break;
                increments.push({ id: now + i, timestamp: triggerTime });
            }

            return {
                events: [event],
                increments: { [event.id]: increments }
            };
        };
        
        const getInitialData = () => {
            try {
                const data = localStorage.getItem(DB_KEY);
                const parsed = data ? JSON.parse(data) : null;
                if (parsed && Array.isArray(parsed.events) && parsed.events.length > 0) {
                    return parsed;
                }
            } catch (error) {
                console.error("Failed to parse data from localStorage", error);
            }
            return generateFakeData();
        };

        const saveData = (data) => localStorage.setItem(DB_KEY, JSON.stringify(data));

        // --- Main App Component ---
        const App = () => {
            const [data, setData] = useState(getInitialData);
            const [route, setRoute] = useState(window.location.hash);
            const [newEventName, setNewEventName] = useState('');

            // Effect to handle URL hash changes for routing
            useEffect(() => {
                const handleHashChange = () => {
                    setRoute(window.location.hash);
                };
                window.addEventListener('hashchange', handleHashChange);
                return () => window.removeEventListener('hashchange', handleHashChange);
            }, []);

            // This effect runs once on app load to handle any shortcut actions
            useEffect(() => {
                const urlParams = new URLSearchParams(window.location.search);
                const action = urlParams.get('action');
                const eventId = parseInt(urlParams.get('event'), 10);

                if (action === 'increment' && eventId) {
                    setData(prevData => {
                        const incrementsForEvent = prevData.increments[eventId] || [];
                        const newIncrements = [...incrementsForEvent, { id: Date.now(), timestamp: Date.now() }];
                        const newData = {
                            ...prevData,
                            increments: { ...prevData.increments, [eventId]: newIncrements }
                        };
                        saveData(newData);
                        return newData;
                    });
                    window.history.replaceState({}, document.title, window.location.pathname);
                }
            }, []);

            useEffect(() => { saveData(data); }, [data]);

            const handleAddEvent = () => {
                if (newEventName.trim()) {
                    const newEvent = { id: Date.now(), name: newEventName.trim() };
                    setData(prev => ({
                        ...prev,
                        events: [...prev.events, newEvent],
                        increments: { ...prev.increments, [newEvent.id]: [] }
                    }));
                    setNewEventName('');
                }
            };

            const updateEventData = (eventId, newIncrements) => {
                setData(prev => ({
                    ...prev,
                    increments: { ...prev.increments, [eventId]: newIncrements }
                }));
            };

            const deleteEvent = (eventId) => {
                setData(prev => {
                    const newEvents = prev.events.filter(e => e.id !== eventId);
                    const newIncrements = { ...prev.increments };
                    delete newIncrements[eventId];
                    return { events: newEvents, increments: newIncrements };
                });
                window.location.hash = ''; // Go back to home after delete
            };

            // --- Routing Logic ---
            let currentView;
            const routeParts = route.replace(/^#\/?|\/$/g, '').split('/');
            
            if (routeParts[0] === 'event' && routeParts[1]) {
                const eventId = parseInt(routeParts[1], 10);
                const selectedEvent = data.events.find(e => e.id === eventId);
                if (selectedEvent) {
                    currentView = (
                        <EventDetail
                            event={selectedEvent}
                            increments={data.increments[selectedEvent.id] || []}
                            onUpdate={(newIncrements) => updateEventData(selectedEvent.id, newIncrements)}
                            onDelete={() => deleteEvent(selectedEvent.id)}
                            onBack={() => window.location.hash = ''}
                        />
                    );
                } else {
                    // Event not found, redirect to home
                    window.location.hash = '';
                }
            } else {
                currentView = (
                    <div>
                        <header className="mb-6">
                            <h1 className="text-4xl font-bold text-gray-800">Event Tracker</h1>
                            <p className="text-gray-500">A simple PWA to track your habits.</p>
                        </header>
                        <form onSubmit={(e) => { e.preventDefault(); handleAddEvent(); }} className="flex gap-2 mb-6">
                            <input
                                type="text" value={newEventName} onChange={(e) => setNewEventName(e.target.value)}
                                placeholder="Add a new event..."
                                className="flex-grow p-3 border rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none"
                            />
                            <button type="submit" className="bg-green-500 text-white px-6 py-3 rounded-lg font-semibold hover:bg-green-600 transition-colors">Add</button>
                        </form>
                        {data.events.length > 0 ? (
                            <div className="space-y-4">
                                {data.events.map(event => (
                                    <EventCard
                                        key={event.id} event={event} increments={data.increments[event.id] || []}
                                        onUpdate={(newIncrements) => updateEventData(event.id, newIncrements)}
                                        onSelect={() => window.location.hash = `/event/${event.id}`}
                                    />
                                ))}
                            </div>
                        ) : (
                            <div className="text-center py-10 px-6 bg-white rounded-lg shadow"><p className="text-gray-500">No events yet. Add one to get started!</p></div>
                        )}
                    </div>
                );
            }

            return (
                <div className="max-w-4xl mx-auto p-4 md:p-6">
                    {currentView}
                </div>
            );
        };

        // --- Child Components ---

        const EventCard = ({ event, increments, onUpdate, onSelect }) => {
            const handleIncrement = (e) => {
                e.stopPropagation();
                onUpdate([...increments, { id: Date.now(), timestamp: Date.now() }]);
            };
            
            const startDate = useMemo(() => {
                if (!increments || increments.length === 0) return null;
                const firstTimestamp = Math.min(...increments.map(inc => inc.timestamp));
                return new Date(firstTimestamp).toLocaleDateString();
            }, [increments]);

            return (
                <div onClick={onSelect} className="bg-white p-4 rounded-lg shadow-md flex justify-between items-center cursor-pointer hover:shadow-lg transition-shadow">
                    <div>
                        <h2 className="text-xl font-semibold text-gray-700">{event.name}</h2>
                        {startDate && (
                            <p className="text-xs text-gray-500 mt-1">
                                Tracking since: <span className="font-semibold">{startDate}</span>
                            </p>
                        )}
                        <p className="text-3xl font-bold text-green-600 mt-2">{increments.length}</p>
                    </div>
                    <div className="flex items-center gap-3">
                        <button onClick={handleIncrement} className="bg-green-500 text-white w-20 h-20 rounded-full flex items-center justify-center text-4xl font-bold hover:bg-green-600 transition-colors">+</button>
                    </div>
                </div>
            );
        };

        const Statistics = ({ increments }) => {
            const stats = useMemo(() => {
                if (increments.length < 2) {
                    return { avgPerMonth: increments.length > 0 ? 1 : 0, avgTimeBetween: 'N/A', total: increments.length };
                }
                const sorted = [...increments].sort((a, b) => a.timestamp - b.timestamp);
                
                const months = new Set();
                sorted.forEach(inc => {
                    const d = new Date(inc.timestamp);
                    months.add(`${d.getFullYear()}-${d.getMonth()}`);
                });
                const avgPerMonth = months.size > 0 ? (sorted.length / months.size).toFixed(1) : 0;

                let totalDiff = 0;
                for (let i = 1; i < sorted.length; i++) {
                    totalDiff += sorted[i].timestamp - sorted[i-1].timestamp;
                }
                const avgDiff = totalDiff / (sorted.length - 1);
                
                const days = Math.floor(avgDiff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((avgDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const avgTimeBetween = `${days}d ${hours}h`;

                return { avgPerMonth, avgTimeBetween, total: sorted.length };
            }, [increments]);

            return (
                <div className="grid grid-cols-3 gap-2 mb-6 text-center">
                    <div className="bg-green-100 p-2 rounded-lg">
                        <div className="text-xl font-bold text-green-800">{stats.total}</div>
                        <div className="text-xs text-green-600">Total</div>
                    </div>
                    <div className="bg-blue-100 p-2 rounded-lg">
                        <div className="text-xl font-bold text-blue-800">{stats.avgPerMonth}</div>
                        <div className="text-xs text-blue-600">Avg/Month</div>
                    </div>
                    <div className="bg-yellow-100 p-2 rounded-lg">
                        <div className="text-xl font-bold text-yellow-800">{stats.avgTimeBetween}</div>
                        <div className="text-xs text-yellow-600">Avg Between</div>
                    </div>
                </div>
            );
        };

        const EventDetail = ({ event, increments, onUpdate, onDelete, onBack }) => {
            const [activeView, setActiveView] = useState('chart');
            const [confirmModal, setConfirmModal] = useState({ isOpen: false, title: '', message: '', onConfirm: null });

            const startDate = useMemo(() => {
                if (!increments || increments.length === 0) return null;
                const firstTimestamp = Math.min(...increments.map(inc => inc.timestamp));
                return new Date(firstTimestamp).toLocaleDateString();
            }, [increments]);

            const handleDayUpdate = (date, newDayIncrements) => {
                const startOfDay = new Date(date.getFullYear(), date.getMonth(), date.getDate()).getTime();
                const endOfDay = startOfDay + 24 * 60 * 60 * 1000 -1;

                const otherIncrements = increments.filter(inc => inc.timestamp < startOfDay || inc.timestamp > endOfDay);
                onUpdate([...otherIncrements, ...newDayIncrements]);
            };

            const requestEventDelete = () => {
                setConfirmModal({
                    isOpen: true,
                    title: 'Delete Event',
                    message: `Are you sure you want to permanently delete "${event.name}" and all its data? This action cannot be undone.`,
                    onConfirm: () => onDelete()
                });
            };

            const requestIncrementDelete = (incrementToDelete) => {
                setConfirmModal({
                    isOpen: true,
                    title: 'Delete Entry',
                    message: `Are you sure you want to delete the entry from ${new Date(incrementToDelete.timestamp).toLocaleString()}?`,
                    onConfirm: () => {
                        const newIncrements = increments.filter(inc => inc.id !== incrementToDelete.id);
                        onUpdate(newIncrements);
                    }
                });
            };

            return (
                <div className="bg-white p-6 rounded-lg shadow-lg">
                    <div className="flex justify-between items-center mb-4">
                        <a href="#" onClick={onBack} className="text-green-600 hover:underline">&larr; Back</a>
                        <button onClick={requestEventDelete} className="bg-red-500 text-white px-4 py-2 rounded-lg font-semibold hover:bg-red-600">Delete Event</button>
                    </div>
                    <h1 className="text-4xl font-bold text-gray-800">{event.name}</h1>
                    {startDate && (
                        <p className="text-sm text-gray-500 mb-4">
                            Tracking since: <span className="font-semibold">{startDate}</span>
                        </p>
                    )}
                    
                    <Statistics increments={increments} />

                    <div className="flex justify-center gap-2 p-1 bg-gray-200 rounded-lg mb-4">
                        {['chart', 'calendar', 'list'].map(view => (
                            <button key={view} onClick={() => setActiveView(view)} className={`flex-1 px-4 py-2 rounded-md font-semibold capitalize transition-colors ${activeView === view ? 'bg-white shadow' : 'bg-transparent text-gray-600 hover:bg-gray-300'}`}>
                                {view}
                            </button>
                        ))}
                    </div>
                    
                    {activeView === 'chart' && <ChartView increments={increments} />}
                    {activeView === 'calendar' && <CalendarView increments={increments} onDayUpdate={handleDayUpdate} />}
                    {activeView === 'list' && <ListView increments={increments} onIncrementDeleteRequest={requestIncrementDelete} />}
                    
                    {confirmModal.isOpen && (
                        <ConfirmationModal
                            title={confirmModal.title}
                            message={confirmModal.message}
                            onConfirm={() => {
                                confirmModal.onConfirm();
                                setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: null });
                            }}
                            onCancel={() => setConfirmModal({ isOpen: false, title: '', message: '', onConfirm: null })}
                        />
                    )}
                </div>
            );
        };
        
        const ChartView = ({ increments }) => {
            const chartRef = useRef(null);
            const chartInstance = useRef(null);
            const [groupBy, setGroupBy] = useState('week'); // 'day', 'week', 'month', 'year'

            useEffect(() => {
                if (!chartRef.current || increments.length === 0) return;

                const getGroupKey = (timestamp, unit) => {
                    const d = new Date(timestamp);
                    if (unit === 'day') return new Date(d.getFullYear(), d.getMonth(), d.getDate()).toISOString().split('T')[0];
                    if (unit === 'month') return `${d.getFullYear()}-${String(d.getMonth() + 1).padStart(2, '0')}`;
                    if (unit === 'year') return d.getFullYear().toString();
                    // week
                    const dCopy = new Date(d.valueOf());
                    const dayNum = (d.getDay() + 6) % 7;
                    dCopy.setDate(dCopy.getDate() - dayNum + 3);
                    const firstThursday = dCopy.valueOf();
                    dCopy.setMonth(0, 1);
                    if (dCopy.getDay() !== 4) {
                        dCopy.setMonth(0, 1 + ((4 - dCopy.getDay()) + 7) % 7);
                    }
                    const weekNumber = 1 + Math.ceil((firstThursday - dCopy) / 604800000);
                    return `${d.getFullYear()}-W${String(weekNumber).padStart(2, '0')}`;
                };

                const dataByGroup = increments.reduce((acc, inc) => {
                    const key = getGroupKey(inc.timestamp, groupBy);
                    acc[key] = (acc[key] || 0) + 1;
                    return acc;
                }, {});

                const sortedKeys = Object.keys(dataByGroup).sort();
                const labels = sortedKeys;
                const data = sortedKeys.map(key => dataByGroup[key]);

                if (chartInstance.current) {
                    chartInstance.current.destroy();
                }

                chartInstance.current = new Chart(chartRef.current, {
                    type: 'bar',
                    data: {
                        labels: labels,
                        datasets: [{
                            label: `Triggers per ${groupBy}`,
                            data: data,
                            backgroundColor: 'rgba(76, 175, 80, 0.5)',
                            borderColor: 'rgba(76, 175, 80, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        scales: {
                            y: { beginAtZero: true, ticks: { stepSize: 1 } },
                            x: { type: 'category' }
                        },
                        plugins: {
                            tooltip: {
                                callbacks: {
                                    title: (context) => `Count: ${context[0].formattedValue}`
                                }
                            }
                        }
                    }
                });

                return () => chartInstance.current?.destroy();
            }, [increments, groupBy]);

            return (
                <div>
                    <div className="flex justify-center gap-2 mb-4">
                        {['day', 'week', 'month', 'year'].map(unit => (
                            <button key={unit} onClick={() => setGroupBy(unit)} className={`px-3 py-1 text-sm rounded-md capitalize ${groupBy === unit ? 'bg-green-500 text-white' : 'bg-gray-200'}`}>
                                {unit}s
                            </button>
                        ))}
                    </div>
                    <canvas ref={chartRef}></canvas>
                </div>
            );
        };

        const ListView = ({ increments, onIncrementDeleteRequest }) => {
            const groupedIncrements = useMemo(() => {
                const groups = {};
                const sorted = [...increments].sort((a, b) => b.timestamp - a.timestamp);
                sorted.forEach(inc => {
                    const d = new Date(inc.timestamp);
                    const year = d.getFullYear();
                    const month = d.toLocaleString('default', { month: 'long' });
                    const yearMonth = `${month} ${year}`;
                    if (!groups[yearMonth]) {
                        groups[yearMonth] = [];
                    }
                    groups[yearMonth].push(inc);
                });
                return groups;
            }, [increments]);

            return (
                <div className="max-h-96 overflow-y-auto space-y-4 pr-2">
                    {Object.entries(groupedIncrements).map(([groupTitle, groupIncrements]) => (
                        <div key={groupTitle}>
                            <h3 className="text-lg font-bold text-gray-700 mb-2 border-b pb-1">{groupTitle}</h3>
                            <div className="space-y-2">
                                {groupIncrements.map(inc => (
                                    <div key={inc.id} className="bg-gray-100 p-3 rounded-md flex justify-between items-center">
                                        <div>
                                            <span className="font-semibold">{new Date(inc.timestamp).toLocaleDateString(undefined, { weekday: 'long', day: 'numeric' })}</span>
                                            <span className="text-gray-600 ml-4">{new Date(inc.timestamp).toLocaleTimeString()}</span>
                                        </div>
                                        <button 
                                            onClick={() => onIncrementDeleteRequest(inc)}
                                            className="text-red-500 font-bold text-xl hover:text-red-700 w-8 h-8 flex items-center justify-center rounded-full hover:bg-red-100 transition-colors"
                                            aria-label="Delete this entry"
                                        >
                                            &times;
                                        </button>
                                    </div>
                                ))}
                            </div>
                        </div>
                    ))}
                </div>
            );
        };

        const CalendarView = ({ increments, onDayUpdate }) => {
            const [currentDate, setCurrentDate] = useState(new Date());
            const [tooltip, setTooltip] = useState({ visible: false, x: 0, y: 0, content: [] });
            const [dayActionModal, setDayActionModal] = useState({ visible: false, date: null });

            const incrementsByDay = useMemo(() => {
                return increments.reduce((acc, inc) => {
                    const dayStart = new Date(new Date(inc.timestamp).setHours(0,0,0,0)).getTime();
                    if (!acc[dayStart]) acc[dayStart] = [];
                    acc[dayStart].push(inc);
                    return acc;
                }, {});
            }, [increments]);
            
            const handleDayHover = (e, dayIncrements) => {
                if (dayIncrements.length > 0) {
                    const rect = e.target.getBoundingClientRect();
                    setTooltip({
                        visible: true,
                        x: rect.left + rect.width / 2,
                        y: rect.top,
                        content: dayIncrements.map(inc => new Date(inc.timestamp).toLocaleTimeString())
                    });
                }
            };
            
            const handleDayClick = (date) => {
                setDayActionModal({ visible: true, date });
            };

            const handleOverride = (newCount) => {
                const newIncrements = Array.from({ length: newCount }, (_, i) => ({
                    id: Date.now() + i,
                    timestamp: dayActionModal.date.getTime() + 12 * 3600 * 1000 // Noon
                }));
                onDayUpdate(dayActionModal.date, newIncrements);
                setDayActionModal({ visible: false, date: null });
            };

            const handleReset = () => {
                onDayUpdate(dayActionModal.date, []);
                setDayActionModal({ visible: false, date: null });
            };

            const year = currentDate.getFullYear();
            const month = currentDate.getMonth();
            const firstDayOfMonth = new Date(year, month, 1).getDay();
            const daysInMonth = new Date(year, month + 1, 0).getDate();
            const dayHeaders = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];

            return (
                <>
                    {tooltip.visible && ReactDOM.createPortal(
                        <div className="tooltip" style={{ left: tooltip.x, top: tooltip.y }}>
                            <ul className="list-none p-0 m-0">{tooltip.content.map((time, i) => <li key={i}>{time}</li>)}</ul>
                        </div>,
                        document.body
                    )}
                    {dayActionModal.visible && (
                        <DayActionModal 
                            date={dayActionModal.date}
                            onClose={() => setDayActionModal({ visible: false, date: null })}
                            onOverride={handleOverride}
                            onReset={handleReset}
                        />
                    )}
                    <div className="p-4 border rounded-lg">
                        <div className="flex justify-between items-center mb-4">
                            <button onClick={() => setCurrentDate(new Date(year, month - 1, 1))} className="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">&lt;</button>
                            <h3 className="font-bold text-lg">{currentDate.toLocaleString('default', { month: 'long', year: 'numeric' })}</h3>
                            <button onClick={() => setCurrentDate(new Date(year, month + 1, 1))} className="px-3 py-1 rounded bg-gray-200 hover:bg-gray-300">&gt;</button>
                        </div>
                        <div className="calendar-grid">
                            {dayHeaders.map(day => <div key={day} className="calendar-day-header text-center font-semibold">{day}</div>)}
                            {Array.from({ length: firstDayOfMonth }).map((_, i) => <div key={`empty-${i}`} />)}
                            {Array.from({ length: daysInMonth }).map((_, day) => {
                                const dayNumber = day + 1;
                                const date = new Date(year, month, dayNumber);
                                const dayTime = date.getTime();
                                const dayIncrements = incrementsByDay[dayTime] || [];
                                const isMarked = dayIncrements.length > 0;
                                return (
                                    <div key={dayNumber} className={`calendar-day flex items-center justify-center cursor-pointer ${isMarked ? 'marked-day' : ''}`}
                                        onMouseEnter={(e) => handleDayHover(e, dayIncrements)}
                                        onMouseLeave={() => setTooltip({ visible: false, x: 0, y: 0, content: [] })}
                                        onClick={() => handleDayClick(date)}
                                    >
                                        {dayNumber}
                                    </div>
                                );
                            })}
                        </div>
                    </div>
                </>
            );
        };

        const DayActionModal = ({ date, onClose, onOverride, onReset }) => {
            const [count, setCount] = useState('');
            const handleSubmit = (e) => {
                e.preventDefault();
                const num = parseInt(count, 10);
                if (!isNaN(num) && num >= 0) onOverride(num);
            };
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={onClose}>
                    <div className="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm" onClick={e => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold mb-2">Actions for {date.toLocaleDateString()}</h2>
                        <form onSubmit={handleSubmit} className="mb-4">
                            <label className="block text-sm font-medium text-gray-700 mb-1">Override Count for this Day</label>
                            <div className="flex gap-2">
                                <input type="number" value={count} onChange={(e) => setCount(e.target.value)} placeholder="New count" className="w-full p-2 border rounded-lg focus:ring-2 focus:ring-green-500 focus:outline-none" autoFocus />
                                <button type="submit" className="px-4 py-2 bg-yellow-500 text-white rounded-lg hover:bg-yellow-600">Set</button>
                            </div>
                        </form>
                        <button onClick={onReset} className="w-full px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">Reset Day to 0</button>
                        <button onClick={onClose} className="w-full mt-4 px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                    </div>
                </div>
            );
        };

        const ConfirmationModal = ({ onConfirm, onCancel, title, message }) => {
            return (
                <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50" onClick={onCancel}>
                    <div className="bg-white p-8 rounded-lg shadow-xl w-full max-w-sm" onClick={e => e.stopPropagation()}>
                        <h2 className="text-2xl font-bold mb-2">{title}</h2>
                        <p className="text-gray-600 mb-6">{message}</p>
                        <div className="flex justify-end gap-3">
                            <button onClick={onCancel} className="px-4 py-2 bg-gray-200 rounded-lg hover:bg-gray-300">Cancel</button>
                            <button onClick={onConfirm} className="px-4 py-2 bg-red-500 text-white rounded-lg hover:bg-red-600">Delete</button>
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    <script>
        if ('serviceWorker' in navigator && (window.location.protocol === 'http:' || window.location.protocol === 'https:')) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('./service-worker.js').catch(err => console.error('SW registration failed:', err));
            });
        }
    </script>
</body>
</html>
